import { __decorate, __param } from "tslib";
import { MAT_DIALOG_DATA } from '@angular/material/dialog';
import { Component, EventEmitter, Output, Inject } from '@angular/core';
import { twoDigits, convertHoursForMode } from '../util';
var MatTimepickerComponentDialogComponent = /** @class */ (function () {
    function MatTimepickerComponentDialogComponent(data) {
        this.data = data;
        this.twoDigits = twoDigits;
        this.changeEvent = new EventEmitter();
        this.okClickEvent = new EventEmitter();
        this.cancelClickEvent = new EventEmitter();
        this.allowed24HourMap = null;
        this.allowed12HourMap = null;
        this.invalidSelection = false;
        this.viewType = 'hours';
        this.isPm = false;
        this.skipMinuteAutoSwitch = false;
        this.autoSwitchID = null;
        this.invalidMedianID = null;
        this.hasInvalidMeridiem = false;
        this.editHoursClicked = false;
        this.isClosing = false;
        this.isPm = data.isPm;
        this.bindData(data);
        // keep this always at the bottom
        this.value = data.value;
    }
    Object.defineProperty(MatTimepickerComponentDialogComponent.prototype, "value", {
        get: function () { return this._value; },
        set: function (value) {
            value = value || this.minDate || this.maxDate || new Date();
            this.hours = value.getHours();
            this.minutes = value.getMinutes();
            this._value = value;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MatTimepickerComponentDialogComponent.prototype, "hours", {
        get: function () { return this._hours; },
        set: function (value) {
            this._hours = value;
            this._formattedHour = convertHoursForMode(this.hours, this.mode).hour;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(MatTimepickerComponentDialogComponent.prototype, "formattedHours", {
        get: function () { return this._formattedHour; },
        enumerable: true,
        configurable: true
    });
    MatTimepickerComponentDialogComponent.prototype.bindData = function (data) {
        this.mode = data.mode;
        this.okLabel = data.okLabel;
        this.cancelLabel = data.cancelLabel;
        this.color = data.color;
        this.minDate = data.minDate;
        this.maxDate = data.maxDate;
        this.allowed12HourMap = data.allowed12HourMap;
        this.allowed24HourMap = data.allowed24HourMap;
    };
    MatTimepickerComponentDialogComponent.prototype.ngDoCheck = function () { this.bindData(this.data); };
    MatTimepickerComponentDialogComponent.prototype.handleClockChange = function (_a) {
        var value = _a.value, type = _a.type;
        var is24hoursAutoMeridiemChange = this.mode === '24h' && type === 'hours' && ((this.hours >= 12 && value < 12) || (this.hours < 12 && value >= 12));
        if ((this.hasInvalidMeridiem && this.mode === '12h') || is24hoursAutoMeridiemChange) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        if ((type && type === 'hours') || (!type && this.viewType === 'hours')) {
            this.hours = value;
        }
        else if ((type && type === 'minutes') || (!type && this.viewType === 'minutes')) {
            this.minutes = value;
        }
        var newValue = new Date();
        var hours = this.isPm ? this.hours < 12 ? this.hours + 12 : this.hours : this.hours === 12 ? 0 : this.hours;
        newValue.setHours(hours);
        newValue.setMinutes(this.minutes);
        newValue.setSeconds(0);
        newValue.setMilliseconds(0);
        this.value = newValue;
        this.changeEvent.emit(newValue);
    };
    MatTimepickerComponentDialogComponent.prototype.clearInvalidMeridiem = function () {
        this.hasInvalidMeridiem = false;
    };
    MatTimepickerComponentDialogComponent.prototype.handleUnavailableSelection = function () {
        clearTimeout(this.autoSwitchID);
    };
    MatTimepickerComponentDialogComponent.prototype.handleClockChangeDone = function (e) {
        var _this = this;
        e.preventDefault(); // prevent mouseUp after touchEnd
        if (this.viewType === 'hours' && !this.skipMinuteAutoSwitch) {
            this.autoSwitchID = setTimeout(function () {
                _this.editMinutes();
                _this.autoSwitchID = null;
            }, 300);
        }
    };
    MatTimepickerComponentDialogComponent.prototype.editHours = function () {
        var _this = this;
        this.viewType = 'hours';
        this.editHoursClicked = true;
        setTimeout(function () { _this.editHoursClicked = false; }, 0);
    };
    MatTimepickerComponentDialogComponent.prototype.editMinutes = function () {
        if (this.hasInvalidMeridiem) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        this.viewType = 'minutes';
    };
    MatTimepickerComponentDialogComponent.prototype.invalidSelectionHandler = function (value) {
        this.invalidSelection = value;
    };
    MatTimepickerComponentDialogComponent.prototype.invalidMeridiem = function () {
        var _this = this;
        if (this.viewType !== 'minutes' && this.editHoursClicked) {
            if (this.invalidMedianID) {
                return;
            }
            this.invalidMedianID = setTimeout(function () {
                _this.isPm = !_this.isPm;
                _this.hasInvalidMeridiem = false;
            }, 0);
            return;
        }
        this.hasInvalidMeridiem = true;
    };
    MatTimepickerComponentDialogComponent.prototype.meridiemChange = function (hours) {
        var changeData = {
            type: this.viewType,
            value: this.viewType === 'hours' ? hours : this.value.getMinutes()
        };
        this.handleClockChange(changeData);
    };
    MatTimepickerComponentDialogComponent.prototype.setAm = function () {
        if (this.hours >= 12) {
            this.hours = this.hours - 12;
        }
        this.isPm = false;
        this.meridiemChange(this.hours);
    };
    MatTimepickerComponentDialogComponent.prototype.setPm = function () {
        if (this.hours < 12) {
            this.hours = this.hours + 12;
        }
        this.isPm = true;
        this.meridiemChange(this.hours);
    };
    MatTimepickerComponentDialogComponent.prototype.okClickHandler = function () {
        if (this.hasInvalidMeridiem) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        this.okClickEvent.emit();
    };
    MatTimepickerComponentDialogComponent.prototype.cancelClickHandler = function () {
        this.cancelClickEvent.emit();
    };
    MatTimepickerComponentDialogComponent.ctorParameters = function () { return [
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    __decorate([
        Output()
    ], MatTimepickerComponentDialogComponent.prototype, "changeEvent", void 0);
    __decorate([
        Output()
    ], MatTimepickerComponentDialogComponent.prototype, "okClickEvent", void 0);
    __decorate([
        Output()
    ], MatTimepickerComponentDialogComponent.prototype, "cancelClickEvent", void 0);
    MatTimepickerComponentDialogComponent = __decorate([
        Component({
            selector: 'mat-timepicker-dialog',
            template: "<mat-dialog-content>\n  <div class=\"root\">\n    <mat-toolbar [color]=\"color\" class=\"header\">\n      <div class=\"placeholder\"></div>\n      <div class=\"time-frame\">\n        <span class=\"time fixed-font-size\" [ngClass]=\"{'select': this.viewType === 'hours' && 'active' }\"\n          (click)=\"editHours()\">\n          {{ twoDigits(formattedHours) }}\n        </span>\n        <span class=\"fixed-font-size\">:</span>\n        <span class=\"time fixed-font-size\" [ngClass]=\"{ 'select': this.viewType === 'minutes' && 'active' }\"\n          (click)=\"editMinutes()\">\n          {{ twoDigits(minutes) }}\n        </span>\n      </div>\n      <ng-container *ngIf=\"mode === '12h' then ampm else normal\"></ng-container>\n      <ng-template #normal>\n        <div class=\"placeholder\"></div>\n      </ng-template>\n      <ng-template #ampm>\n        <div class=\"ampm\">\n          <span class=\"time\" [ngClass]=\"{ 'select': isPm }\" (click)=\"setPm()\">PM</span>\n          <span class=\"time\" [ngClass]=\"{ 'select': !isPm }\" (click)=\"setAm()\">AM</span>\n        </div>\n      </ng-template>\n    </mat-toolbar>\n    <div class=\"body\">\n      <mat-clock [allowed12HourMap]=\"allowed12HourMap\" [allowed24HourMap]=\"allowed24HourMap\" [minDate]=\"minDate\"\n        [maxDate]=\"maxDate\" [color]=\"color\" [viewType]=\"viewType\" [mode]=\"mode\" [formattedHours]=\"formattedHours\"\n        [minutes]=\"minutes\" (changeEvent)=\"handleClockChange($event)\"\n        (unavailableSelection)=\"handleUnavailableSelection()\"\n        [formattedValue]=\"viewType === 'minutes' ? minutes : formattedHours\" [isPm]=\"isPm\"\n        (invalidMeridiem)=\"invalidMeridiem()\" (mouseup)=\"handleClockChangeDone($event)\"\n        (clearInvalidMeridiem)=\"clearInvalidMeridiem()\" (touchend)=\"handleClockChangeDone($event)\"\n        (invalidSelection)=\"invalidSelectionHandler($event)\"></mat-clock>\n    </div>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button i18n=\"mat-timepicker|Material Timepicker Cancel Button Text\" [color]=\"color\"\n    (click)=\"cancelClickHandler()\">{{cancelLabel}}</button>\n  <button mat-button i18n=\"mat-timepicker|Material Timepicker Ok Button Text\" [disabled]=\"invalidSelection\"\n    [color]=\"color\" (click)=\"okClickHandler()\">{{okLabel}}</button>\n</mat-dialog-actions>",
            styles: ["mat-dialog-content{min-height:395px;padding:0;margin-top:-24px;overflow:hidden}mat-dialog-actions{justify-content:flex-end;margin-right:-8px;margin-left:-8px}.root{min-width:282px}.header{border-top-left-radius:2px;border-top-right-radius:2px;padding:20px 0;line-height:58px;font-size:58px;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:98px}.header .fixed-font-size{font-size:58px}.header .time-frame{height:60px}.time{transition:.2s ease-out;cursor:pointer}.time:not(.select){opacity:.6}.placeholder{flex:1}.ampm{display:flex;flex-direction:column-reverse;flex:1;font-size:14px;line-height:20px;margin-left:16px;font-weight:700px}.select{color:#fff}.body{padding:24px 16px 20px;display:flex;justify-content:center}"]
        }),
        __param(0, Inject(MAT_DIALOG_DATA))
    ], MatTimepickerComponentDialogComponent);
    return MatTimepickerComponentDialogComponent;
}());
export { MatTimepickerComponentDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvdGltZXBpY2tlci1kaWFsb2cvdGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBVyxNQUFNLGVBQWUsQ0FBQztBQUVqRixPQUFPLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBT3pEO0lBbUVFLCtDQUE0QyxJQUFJO1FBQUosU0FBSSxHQUFKLElBQUksQ0FBQTtRQWpFaEQsY0FBUyxHQUFHLFNBQVMsQ0FBQztRQUVaLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekQsaUJBQVksR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMxRCxxQkFBZ0IsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUV4RSxxQkFBZ0IsR0FBc0IsSUFBSSxDQUFDO1FBQzNDLHFCQUFnQixHQUFzQixJQUFJLENBQUM7UUFFM0MscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBZXpCLGFBQVEsR0FBa0IsT0FBTyxDQUFDO1FBSWxDLFNBQUksR0FBRyxLQUFLLENBQUM7UUFDYix5QkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDN0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDdkIsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQzNCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBZ0NoQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDdEIsSUFBSSxDQUFD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SUFBSSxDQUFDLElBQUksQ0FBQztZQUN2QixJQUFJLENBQUMsa0JBQWtCLEdBQUcsS0FBSyxDQUFDO1NBQ2pDO1FBQ0QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQsa0VBQWtCLEdBQWxCO1FBQ0UsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksRUFBRSxDQUFDO0lBQy9CLENBQUM7O2dEQXZIWSxNQUFNLFNBQUMsZUFBZTs7SUEvRHpCO1FBQVQsTUFBTSxFQUFFOzhFQUEwRDtJQUN6RDtRQUFULE1BQU0sRUFBRTsrRUFBMkQ7SUFDMUQ7UUFBVCxNQUFNLEVBQUU7bUZBQStEO0lBTjdELHFDQUFxQztRQUxqRCxTQUFTLENBQUM7WUFDVCxRQUFRLEVBQUUsdUJBQXVCO1lBQ2pDLGcwRUFBaUQ7O1NBRWxELENBQUM7UUFvRWEsV0FBQSxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUE7T0FuRXpCLHFDQUFxQyxDQTRMakQ7SUFBRCw0Q0FBQztDQUFBLEFBNUxELElBNExDO1NBNUxZLHFDQUFxQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE1BVF9ESUFMT0dfREFUQSB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQgeyBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBJbmplY3QsIERvQ2hlY2sgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IENsb2NrVmlld1R5cGUsIENsb2NrTW9kZSwgSUFsbG93ZWQyNEhvdXJNYXAsIElBbGxvd2VkMTJIb3VyTWFwIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy1hbmQtdHlwZXMnO1xuaW1wb3J0IHsgdHdvRGlnaXRzLCBjb252ZXJ0SG91cnNGb3JNb2RlIH0gZnJvbSAnLi4vdXRpbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ21hdC10aW1lcGlja2VyLWRpYWxvZycsXG4gIHRlbXBsYXRlVXJsOiAnLi90aW1lcGlja2VyLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3RpbWVwaWNrZXItZGlhbG9nLmNvbXBvbmVudC5zY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgTWF0VGltZXBpY2tlckNvbXBvbmVudERpYWxvZ0NvbXBvbmVudCBpbXBsZW1lbnRzIERvQ2hlY2sge1xuXG4gIHR3b0RpZ2l0cyA9IHR3b0RpZ2l0cztcblxuICBAT3V0cHV0KCkgY2hhbmdlRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBva0NsaWNrRXZlbnQ6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcjxhbnk+KCk7XG4gIEBPdXRwdXQoKSBjYW5jZWxDbGlja0V2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIGFsbG93ZWQyNEhvdXJNYXA6IElBbGxvd2VkMjRIb3VyTWFwID0gbnVsbDtcbiAgYWxsb3dlZDEySG91ck1hcDogSUFsbG93ZWQxMkhvdXJNYXAgPSBudWxsO1xuXG4gIGludmFsaWRTZWxlY3Rpb24gPSBmYWxzZTtcblxuICBva0xhYmVsOiBzdHJpbmc7XG4gIGNhbmNlbExhYmVsOiBzdHJpbmc7XG5cbiAgc2V0IHZhbHVlKHZhbHVlOiBhbnkpIHtcbiAgICB2YWx1ZSA9IHZhbHVlIHx8IHRoaXMubWluRGF0ZSB8fCB0aGlzLm1heERhdGUgfHwgbmV3IERhdGUoKTtcbiAgICB0aGlzLmhvdXJzID0gdmFsdWUuZ2V0SG91cnMoKTtcbiAgICB0aGlzLm1pbnV0ZXMgPSB2YWx1ZS5nZXRNaW51dGVzKCk7XG4gICAgdGhpcy5fdmFsdWUgPSB2YWx1ZTtcbiAgfVxuXG4gIGdldCB2YWx1ZSgpIHsgcmV0dXJuIHRoaXMuX3ZhbHVlOyB9XG5cbiAgbW9kZTogQ2xvY2tNb2RlO1xuICB2aWV3VHlwZTogQ2xvY2tWaWV3VHlwZSA9ICdob3Vycyc7XG5cbiAgbWludXRlczogYW55O1xuICBjb2xvcjogc3RyaW5nO1xuICBpc1BtID0gZmFsc2U7XG4gIHNraXBNaW51dGVBdXRvU3dpdGNoID0gZmFsc2U7XG4gIGF1dG9Td2l0Y2hJRCA9IG51bGw7XG4gIGludmFsaWRNZWRpYW5JRCA9IG51bGw7XG4gIGhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICBlZGl0SG91cnNDbGlja2VkID0gZmFsc2U7XG4gIGlzQ2xvc2luZyA9IGZhbHNlO1xuXG4gIG1pbkRhdGU6IERhdGU7XG4gIG1heERhdGU6IERhdGU7XG5cbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWVcbiAgX2Zvcm1hdHRlZEhvdXI6IGFueTtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOnZhcmlhYmxlLW5hbWVcbiAgX2hvdXJzOiBhbnk7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG4gIF92YWx1ZTogRGF0ZTtcblxuICBzZXQgaG91cnModmFsdWU6IGFueSkge1xuICAgIHRoaXMuX2hvdXJzID0gdmFsdWU7XG4gICAgdGhpcy5fZm9ybWF0dGVkSG91ciA9IGNvbnZlcnRIb3Vyc0Zvck1vZGUodGhpcy5ob3VycywgdGhpcy5tb2RlKS5ob3VyO1xuICB9XG4gIGdldCBob3VycygpIHsgcmV0dXJuIHRoaXMuX2hvdXJzOyB9XG5cbiAgZ2V0IGZvcm1hdHRlZEhvdXJzKCkgeyByZXR1cm4gdGhpcy5fZm9ybWF0dGVkSG91cjsgfVxuXG4gIGJpbmREYXRhKGRhdGE6IGFueSkge1xuICAgIHRoaXMubW9kZSA9IGRhdGEubW9kZTtcbiAgICB0aGlzLm9rTGFiZWwgPSBkYXRhLm9rTGFiZWw7XG4gICAgdGhpcy5jYW5jZWxMYWJlbCA9IGRhdGEuY2FuY2VsTGFiZWw7XG4gICAgdGhpcy5jb2xvciA9IGRhdGEuY29sb3I7XG4gICAgdGhpcy5taW5EYXRlID0gZGF0YS5taW5EYXRlO1xuICAgIHRoaXMubWF4RGF0ZSA9IGRhdGEubWF4RGF0ZTtcbiAgICB0aGlzLmFsbG93ZWQxMkhvdXJNYXAgPSBkYXRhLmFsbG93ZWQxMkhvdXJNYXA7XG4gICAgdGhpcy5hbGxvd2VkMjRIb3VyTWFwID0gZGF0YS5hbGxvd2VkMjRIb3VyTWFwO1xuICB9XG5cbiAgY29uc3RydWN0b3IoQEluamVjdChNQVRfRElBTE9HX0RBVEEpIHB1YmxpYyBkYXRhKSB7XG4gICAgdGhpcy5pc1BtID0gZGF0YS5pc1BtO1xuICAgIHRoaXMuYmluZERhdGEoZGF0YSk7XG4gICAgLy8ga2VlcCB0aGlzIGFsd2F5cyBhdCB0aGUgYm90dG9tXG4gICAgdGhpcy52YWx1ZSA9IGRhdGEudmFsdWU7XG4gIH1cblxuICBuZ0RvQ2hlY2soKSB7IHRoaXMuYmluZERhdGEodGhpcy5kYXRhKTsgfVxuXG4gIGhhbmRsZUNsb2NrQ2hhbmdlKHsgdmFsdWUsIHR5cGUgfTogeyB2YWx1ZTogbnVtYmVyLCB0eXBlOiAnbWludXRlcycgfCAnaG91cnMnIH0pIHtcbiAgICBjb25zdCBpczI0aG91cnNBdXRvTWVyaWRpZW1DaGFuZ2UgPSB0aGlzLm1vZGUgPT09ICcyNGgnICYmIHR5cGUgPT09ICdob3VycycgJiYgKFxuICAgICAgKHRoaXMuaG91cnMgPj0gMTIgJiYgdmFsdWUgPCAxMikgfHwgKHRoaXMuaG91cnMgPCAxMiAmJiB2YWx1ZSA+PSAxMikpO1xuICAgIGlmICgodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gJiYgdGhpcy5tb2RlID09PSAnMTJoJykgfHwgaXMyNGhvdXJzQXV0b01lcmlkaWVtQ2hhbmdlKSB7XG4gICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgICB9XG5cbiAgICBpZiAoKHR5cGUgJiYgdHlwZSA9PT0gJ2hvdXJzJykgfHwgKCF0eXBlICYmIHRoaXMudmlld1R5cGUgPT09ICdob3VycycpKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdmFsdWU7XG4gICAgfSBlbHNlIGlmICgodHlwZSAmJiB0eXBlID09PSAnbWludXRlcycpIHx8ICghdHlwZSAmJiB0aGlzLnZpZXdUeXBlID09PSAnbWludXRlcycpKSB7XG4gICAgICB0aGlzLm1pbnV0ZXMgPSB2YWx1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBuZXdWYWx1ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaG91cnMgPSB0aGlzLmlzUG0gPyB0aGlzLmhvdXJzIDwgMTIgPyB0aGlzLmhvdXJzICsgMTIgOiB0aGlzLmhvdXJzIDogdGhpcy5ob3VycyA9PT0gMTIgPyAwIDogdGhpcy5ob3VycztcbiAgICBuZXdWYWx1ZS5zZXRIb3Vycyhob3Vycyk7XG4gICAgbmV3VmFsdWUuc2V0TWludXRlcyh0aGlzLm1pbnV0ZXMpO1xuICAgIG5ld1ZhbHVlLnNldFNlY29uZHMoMCk7XG4gICAgbmV3VmFsdWUuc2V0TWlsbGlzZWNvbmRzKDApO1xuICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQobmV3VmFsdWUpO1xuICB9XG5cbiAgY2xlYXJJbnZhbGlkTWVyaWRpZW0oKSB7XG4gICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgfVxuXG4gIGhhbmRsZVVuYXZhaWxhYmxlU2VsZWN0aW9uKCkge1xuICAgIGNsZWFyVGltZW91dCh0aGlzLmF1dG9Td2l0Y2hJRCk7XG4gIH1cblxuICBoYW5kbGVDbG9ja0NoYW5nZURvbmUoZSkge1xuICAgIGUucHJldmVudERlZmF1bHQoKTsgLy8gcHJldmVudCBtb3VzZVVwIGFmdGVyIHRvdWNoRW5kXG5cbiAgICBpZiAodGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJyAmJiAhdGhpcy5za2lwTWludXRlQXV0b1N3aXRjaCkge1xuICAgICAgdGhpcy5hdXRvU3dpdGNoSUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5lZGl0TWludXRlcygpO1xuICAgICAgICB0aGlzLmF1dG9Td2l0Y2hJRCA9IG51bGw7XG4gICAgICB9LCAzMDApO1xuICAgIH1cbiAgfVxuXG4gIGVkaXRIb3VycygpIHtcbiAgICB0aGlzLnZpZXdUeXBlID0gJ2hvdXJzJztcbiAgICB0aGlzLmVkaXRIb3Vyc0NsaWNrZWQgPSB0cnVlO1xuICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLmVkaXRIb3Vyc0NsaWNrZWQgPSBmYWxzZTsgfSwgMCk7XG4gIH1cblxuICBlZGl0TWludXRlcygpIHtcbiAgICBpZiAodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0pIHtcbiAgICAgIHRoaXMuaXNQbSA9ICF0aGlzLmlzUG07XG4gICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLnZpZXdUeXBlID0gJ21pbnV0ZXMnO1xuICB9XG5cbiAgaW52YWxpZFNlbGVjdGlvbkhhbmRsZXIodmFsdWUpIHtcbiAgICB0aGlzLmludmFsaWRTZWxlY3Rpb24gPSB2YWx1ZTtcbiAgfVxuXG5cbiAgaW52YWxpZE1lcmlkaWVtKCkge1xuICAgIGlmICh0aGlzLnZpZXdUeXBlICE9PSAnbWludXRlcycgJiYgdGhpcy5lZGl0SG91cnNDbGlja2VkKSB7XG4gICAgICBpZiAodGhpcy5pbnZhbGlkTWVkaWFuSUQpIHsgcmV0dXJuOyB9XG4gICAgICB0aGlzLmludmFsaWRNZWRpYW5JRCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgICAgfSwgMCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtID0gdHJ1ZTtcbiAgfVxuXG4gIG1lcmlkaWVtQ2hhbmdlKGhvdXJzKSB7XG4gICAgY29uc3QgY2hhbmdlRGF0YSA9IHtcbiAgICAgIHR5cGU6IHRoaXMudmlld1R5cGUsXG4gICAgICB2YWx1ZTogdGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJyA/IGhvdXJzIDogdGhpcy52YWx1ZS5nZXRNaW51dGVzKClcbiAgICB9O1xuICAgIHRoaXMuaGFuZGxlQ2xvY2tDaGFuZ2UoY2hhbmdlRGF0YSk7XG4gIH1cblxuXG4gIHNldEFtKCkge1xuICAgIGlmICh0aGlzLmhvdXJzID49IDEyKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdGhpcy5ob3VycyAtIDEyO1xuICAgIH1cbiAgICB0aGlzLmlzUG0gPSBmYWxzZTtcblxuICAgIHRoaXMubWVyaWRpZW1DaGFuZ2UodGhpcy5ob3Vycyk7XG4gIH1cblxuICBzZXRQbSgpIHtcbiAgICBpZiAodGhpcy5ob3VycyA8IDEyKSB7XG4gICAgICB0aGlzLmhvdXJzID0gdGhpcy5ob3VycyArIDEyO1xuICAgIH1cbiAgICB0aGlzLmlzUG0gPSB0cnVlO1xuICAgIHRoaXMubWVyaWRpZW1DaGFuZ2UodGhpcy5ob3Vycyk7XG4gIH1cblxuICBva0NsaWNrSGFuZGxlcigpIHtcbiAgICBpZiAodGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0pIHtcbiAgICAgIHRoaXMuaXNQbSA9ICF0aGlzLmlzUG07XG4gICAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IGZhbHNlO1xuICAgIH1cbiAgICB0aGlzLm9rQ2xpY2tFdmVudC5lbWl0KCk7XG4gIH1cblxuICBjYW5jZWxDbGlja0hhbmRsZXIoKSB7XG4gICAgdGhpcy5jYW5jZWxDbGlja0V2ZW50LmVtaXQoKTtcbiAgfVxuXG59XG4iXX0=