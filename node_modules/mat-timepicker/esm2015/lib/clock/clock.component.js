import { __decorate } from "tslib";
import { Component, Input, Output, EventEmitter, ChangeDetectionStrategy } from '@angular/core';
import { getIsAvailabeFn } from '../util';
let ClockComponent = class ClockComponent {
    constructor() {
        this.color = 'primary';
        this.changeEvent = new EventEmitter();
        this.unavailableSelection = new EventEmitter();
        this.invalidMeridiem = new EventEmitter();
        this.invalidSelection = new EventEmitter();
        this.clearInvalidMeridiem = new EventEmitter();
        this.allowed12HourMap = null;
        this.allowed24HourMap = null;
        this.isFormattedValueAllowed = true;
        this.meridiem = null;
        this.touching = false;
        this.numbers = [];
        this.secondaryNumbers = [];
        this.minuteDots = [];
        this.invalidMeridiemEmitted = true;
        this.handleTouchMove = (e) => {
            e.preventDefault(); // prevent scrolling behind the clock on iOS
            const rect = e.target.getBoundingClientRect();
            this.movePointer(e.changedTouches[0].clientX - rect.left, e.changedTouches[0].clientY - rect.top);
        };
    }
    initIsAllowedFn() {
        if (!this.allowed12HourMap && !this.allowed24HourMap) {
            return;
        }
        this.isAvailableFn = getIsAvailabeFn(this.allowed12HourMap, this.allowed24HourMap, this.mode);
    }
    isAvailable(value) {
        return this.isAvailableFn ? this.isAvailableFn(value, this.viewType, this.isPm, this.formattedHours) : true;
    }
    ngOnChanges(simpleChanges) {
        if (simpleChanges.allowed12HourMap ||
            simpleChanges.allowed24HourMap ||
            (simpleChanges.mode && !simpleChanges.mode.firstChange)) {
            this.initIsAllowedFn();
        }
        this.calculateAngule();
        this.setNumbers();
        this.meridiem = this.isPm ? 'PM' : 'AM';
        if (simpleChanges.formattedValue && (this.allowed12HourMap || this.allowed24HourMap)) {
            this.isFormattedValueAllowed = this.isAvailable(this.formattedValue);
        }
        const isSelectedTimeAvailable = (this.isAvailableFn) ?
            this.isAvailableFn(this.formattedValue, 'minutes', this.isPm, this.formattedHours) : true;
        if (this.mode === '24h' && this.viewType === 'minutes' && this.isAvailableFn) {
            const areMinitesAvailable = this.isAvailableFn(this.minutes, 'minutes', this.isPm, this.formattedHours);
            if (!areMinitesAvailable) {
                if (this.minDate && this.minDate.getMinutes() > this.minutes) {
                    setTimeout(() => { this.changeEvent.emit({ value: this.minDate.getMinutes(), type: 'minutes' }); });
                }
                else {
                    setTimeout(() => { this.changeEvent.emit({ value: this.maxDate.getMinutes(), type: 'minutes' }); });
                }
            }
        }
        if (isSelectedTimeAvailable && this.invalidMeridiemEmitted) {
            this.clearInvalidMeridiem.emit();
            this.invalidMeridiemEmitted = false;
        }
        this.invalidSelection.emit(!isSelectedTimeAvailable);
    }
    calculateAngule() {
        this.angle = this.getPointerAngle(this.formattedValue, this.viewType);
    }
    setNumbers() {
        if (this.viewType === 'hours') {
            if (this.mode === '12h') {
                const meridiem = this.isPm ? 'pm' : 'am';
                const isAllowedFn = this.allowed12HourMap ? num => this.allowed12HourMap[meridiem][num + 1][0] : undefined;
                this.numbers = this.getNumbers(12, { size: 256 }, isAllowedFn);
                this.secondaryNumbers = [];
                this.minuteDots = [];
            }
            else if (this.mode === '24h') {
                const isAllowedFn = this.allowed24HourMap ? num => this.allowed24HourMap[num][0] : undefined;
                this.numbers = this.getNumbers(12, { size: 256 }, isAllowedFn);
                this.secondaryNumbers = this.getNumbers(12, { size: 256 - 64, start: 13 }, isAllowedFn);
                this.minuteDots = [];
            }
        }
        else {
            const meridiem = this.isPm ? 'pm' : 'am';
            const isAllowedFn = !!this.allowed12HourMap ? num => this.allowed12HourMap[meridiem][this.formattedHours][num] :
                !!this.allowed24HourMap ? num => this.allowed24HourMap[this.formattedHours][num] : undefined;
            this.numbers = this.getNumbers(12, { size: 256, start: 5, step: 5 }, isAllowedFn);
            this.minuteDots = this.getNumbers(60, { size: 256, start: 13 }).map(digit => {
                if (digit.display <= 59) {
                    digit.allowed = isAllowedFn ? isAllowedFn(digit.display) : true;
                    return digit;
                }
                digit.display = digit.display - 60;
                digit.allowed = isAllowedFn ? isAllowedFn(digit.display) : true;
                return digit;
            });
            this.secondaryNumbers = [];
        }
    }
    disableAnimatedPointer() {
        this.touching = true;
    }
    enableAnimatedPointer() {
        this.touching = false;
    }
    handleTouchEnd(e) {
        this.handleTouchMove(e);
        this.enableAnimatedPointer();
    }
    handleMouseMove(e) {
        // MouseEvent.which is deprecated, but MouseEvent.buttons is not supported in Safari
        if (e.buttons === 1 || e.which === 1) {
            const rect = e.target.getBoundingClientRect();
            this.movePointer(e.clientX - rect.left, e.clientY - rect.top);
        }
    }
    handleClick(e) {
        const rect = e.target.getBoundingClientRect();
        this.movePointer(e.clientX - rect.left, e.clientY - rect.top);
    }
    movePointer(x, y) {
        const value = this.getPointerValue(x, y, 256);
        if (!this.isAvailable(value)) {
            this.unavailableSelection.emit();
            return;
        }
        if (value !== this.formattedValue) {
            this.changeEvent.emit({ value, type: this.viewType !== 'minutes' ? 'hours' : 'minutes' });
            if (this.viewType !== 'minutes') {
                if (!this.isAvailable(value)) {
                    if (this.minDate && this.isAvailable(value)) {
                        this.changeEvent.emit({ value: this.minDate.getMinutes(), type: 'minutes' });
                    }
                    else if (this.maxDate && this.isAvailable(value)) {
                        this.changeEvent.emit({ value: this.maxDate.getMinutes(), type: 'minutes' });
                    }
                }
            }
        }
    }
    getNumbers(count, { size, start = 1, step = 1 }, isAllowedFn) {
        return Array.apply(null, Array(count)).map((_, i) => ({
            display: i * step + start,
            translateX: (size / 2 - 20) * Math.cos(2 * Math.PI * (i - 2) / count),
            translateY: (size / 2 - 20) * Math.sin(2 * Math.PI * (i - 2) / count),
            allowed: isAllowedFn ? isAllowedFn(i) : true
        }));
    }
    getPointerAngle(value, mode) {
        if (this.viewType === 'hours') {
            return this.mode === '12h' ? 360 / 12 * (value - 3) : 360 / 12 * (value % 12 - 3);
        }
        return 360 / 60 * (value - 15);
    }
    getPointerValue(x, y, size) {
        let value;
        let angle = Math.atan2(size / 2 - x, size / 2 - y) / Math.PI * 180;
        if (angle < 0) {
            angle = 360 + angle;
        }
        if (this.viewType === 'hours') {
            if (this.mode === '12h') {
                value = 12 - Math.round(angle * 12 / 360);
                return value === 0 ? 12 : value;
            }
            const radius = Math.sqrt(Math.pow(size / 2 - x, 2) + Math.pow(size / 2 - y, 2));
            value = 12 - Math.round(angle * 12 / 360);
            if (value === 0) {
                value = 12;
            }
            if (radius < size / 2 - 32) {
                value = value === 12 ? 0 : value + 12;
            }
            return value;
        }
        value = Math.round(60 - 60 * angle / 360);
        return value === 60 ? 0 : value;
    }
};
__decorate([
    Input()
], ClockComponent.prototype, "mode", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "viewType", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "color", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "formattedValue", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "minDate", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "maxDate", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "isPm", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "formattedHours", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "minutes", void 0);
__decorate([
    Output()
], ClockComponent.prototype, "changeEvent", void 0);
__decorate([
    Output()
], ClockComponent.prototype, "unavailableSelection", void 0);
__decorate([
    Output()
], ClockComponent.prototype, "invalidMeridiem", void 0);
__decorate([
    Output()
], ClockComponent.prototype, "invalidSelection", void 0);
__decorate([
    Output()
], ClockComponent.prototype, "clearInvalidMeridiem", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "allowed12HourMap", void 0);
__decorate([
    Input()
], ClockComponent.prototype, "allowed24HourMap", void 0);
ClockComponent = __decorate([
    Component({
        selector: 'mat-clock',
        template: "<div class=\"root\">\n  <div class=\"circle\" (touchmove)=\"handleTouchMove($event)\" (mousemove)=\"handleMouseMove($event)\"\n    (touchstart)=\"disableAnimatedPointer()\" (mousedown)=\"disableAnimatedPointer()\" (touchend)=\"handleTouchEnd($event)\"\n    (mouseup)=\"enableAnimatedPointer()\" (click)=\"handleClick($event)\">\n    <div class=\"pointer-container\"\n      [ngClass]=\"{ 'small-pointer': mode === '24h' && viewType === 'hours' && (formattedValue === 0 || formattedValue > 12), 'animated-pointer': !touching }\"\n      [style.transform]=\"'rotate(' + angle + 'deg)'\">\n      <button mat-mini-fab [color]=\"color\" class=\"inner-dot\"></button>\n      <mat-toolbar [color]=\"color\" class=\"pointer\">\n        <button mat-mini-fab [color]=\"color\" class=\"outer-dot\"\n          [ngClass]=\" { 'outer-dot-odd': viewType === 'minutes' && formattedValue % 5 !== 0 }\">\n          <ng-container *ngIf=\"viewType === 'minutes' && formattedValue % 5 !== 0\">\u00B7</ng-container>\n        </button>\n      </mat-toolbar>\n    </div>\n    <ng-container *ngFor=\"let digit of minuteDots;\">\n      <button mat-mini-fab class=\"number minute-dot\"\n        [ngClass]=\"{ 'selected': formattedValue === digit.display || (digit.display === 0 && formattedValue === 0), 'disabled': !isAvailable(digit.display === 60 ? 0 : digit.display)}\"\n        [style.transform]=\"'translate(' + digit.translateX + 'px, ' + digit.translateY + 'px)'\">\n        <ng-container *ngIf=\"digit.display % 5 !== 0\">\u00B7</ng-container>\n      </button>\n    </ng-container>\n    <ng-container *ngFor=\"let digit of numbers;\">\n      <button mat-mini-fab [color]=\"color\" class=\"number\"\n        [ngClass]=\"{ 'selected': formattedValue === digit.display || (digit.display === 60 && formattedValue === 0), 'disabled': !isAvailable(digit.display === 60 ? 0 : digit.display)}\"\n        [style.transform]=\"'translate(' + digit.translateX + 'px, ' + digit.translateY + 'px)'\">\n        <ng-template #hoursTemplate>{{ digit.display }}</ng-template>\n        <ng-template #minutesTemplate>{{ digit.display === 60 ? '00' : digit.display }}</ng-template>\n        <ng-container *ngIf=\"viewType === 'minutes' then minutesTemplate else hoursTemplate;\"></ng-container>\n      </button>\n\n    </ng-container>\n    <ng-container *ngFor=\"let digit of secondaryNumbers;\">\n      <button mat-mini-fab [color]=\"color\" class=\"number small-number\"\n        [ngClass]=\"{ 'selected': formattedValue === digit.display || (digit.display === 24 && formattedValue === 0), 'disabled': !isAvailable(digit.display === 24 ? 0 : digit.display)}\"\n        [style.transform]=\"'translate(' + digit.translateX + 'px, ' + digit.translateY + 'px)'\">\n        {{ digit.display === 24 ? '00' : digit.display }}\n      </button>\n\n    </ng-container>\n  </div>",
        changeDetection: ChangeDetectionStrategy.OnPush,
        styles: [".root{width:256px;height:256px;cursor:default}.circle{width:256px;height:256px;border-radius:50%;position:relative;background:#ededed;cursor:pointer}.number{width:32px;height:32px;left:calc(50% - 16px);top:calc(50% - 16px);position:absolute;text-align:center;line-height:32px;cursor:pointer;font-size:14px;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;display:flex;align-items:center;justify-content:center;flex-direction:column;background-color:transparent;box-shadow:none}.number.disabled{color:rgba(1,1,1,.1)}.number:not(.selected):not(.disabled){color:rgba(0,0,0,.87)}.number:not(.disabled).minute-dot{color:rgba(1,1,1,.7)}.number:not(.disabled).minute-dot.selected{color:transparent}.small-number{font-size:12px}.small-number:not(.selected):not(.disabled){color:rgba(0,0,0,.67)}.pointer-container{width:calc(50% - 20px);height:2;position:absolute;left:50%;top:calc(50% - 1px);transform-origin:left center;pointer-events:none}.pointer-container.disabled *{background-color:transparent}.pointer{height:1px}.animated-pointer{transition:.2s ease-out}.small-pointer{width:calc(50% - 52px)}.inner-dot{position:absolute;top:-3px;left:-4px;width:8px;height:8px;border-radius:50%;box-shadow:none}.outer-dot{width:32px;height:32px;position:absolute;right:-16px;box-shadow:none;border-radius:50%;box-sizing:content-box}.outer-dot-odd{box-shadow:none;width:32px;height:32px;display:flex;align-items:center;justify-content:center;flex-direction:column}"]
    })
], ClockComponent);
export { ClockComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2xvY2suY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvY2xvY2svY2xvY2suY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUE0Qix1QkFBdUIsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUxSCxPQUFPLEVBQWEsZUFBZSxFQUFFLE1BQU0sU0FBUyxDQUFDO0FBUXJELElBQWEsY0FBYyxHQUEzQixNQUFhLGNBQWM7SUFBM0I7UUFJVyxVQUFLLEdBQUcsU0FBUyxDQUFDO1FBT2pCLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekQseUJBQW9CLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDbEUsb0JBQWUsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUM3RCxxQkFBZ0IsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUM5RCx5QkFBb0IsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUVuRSxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDeEIscUJBQWdCLEdBQUcsSUFBSSxDQUFDO1FBRWpDLDRCQUF1QixHQUFHLElBQUksQ0FBQztRQUkvQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFakIsWUFBTyxHQUFrQixFQUFFLENBQUM7UUFDNUIscUJBQWdCLEdBQWtCLEVBQUUsQ0FBQztRQUNyQyxlQUFVLEdBQWtCLEVBQUUsQ0FBQztRQUMvQiwyQkFBc0IsR0FBRyxJQUFJLENBQUM7UUFpRzlCLG9CQUFlLEdBQUcsQ0FBQyxDQUFNLEVBQUUsRUFBRTtZQUMzQixDQUFDLENBQUMsY0FBYyxFQUFFLENBQUMsQ0FBQyw0Q0FBNEM7WUFDaEUsTUFBTSxJQUFJLEdBQUcsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIs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TlU7SUFBUixLQUFLLEVBQUU7NENBQWlCO0FBQ2hCO0lBQVIsS0FBSyxFQUFFO2dEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTs2Q0FBbUI7QUFDbEI7SUFBUixLQUFLLEVBQUU7c0RBQXdCO0FBQ3ZCO0lBQVIsS0FBSyxFQUFFOytDQUFlO0FBQ2Q7SUFBUixLQUFLLEVBQUU7K0NBQWU7QUFDZDtJQUFSLEtBQUssRUFBRTs0Q0FBZTtBQUNkO0lBQVIsS0FBSyxFQUFFO3NEQUF3QjtBQUN2QjtJQUFSLEtBQUssRUFBRTsrQ0FBaUI7QUFDZjtJQUFULE1BQU0sRUFBRTttREFBMEQ7QUFDekQ7SUFBVCxNQUFNLEVBQUU7NERBQW1FO0FBQ2xFO0lBQVQsTUFBTSxFQUFFO3VEQUE4RDtBQUM3RDtJQUFULE1BQU0sRUFBRTt3REFBK0Q7QUFDOUQ7SUFBVCxNQUFNLEVBQUU7NERBQW1FO0FBRW5FO0lBQVIsS0FBSyxFQUFFO3dEQUF5QjtBQUN4QjtJQUFSLEtBQUssRUFBRTt3REFBeUI7QUFsQnRCLGNBQWM7SUFOMUIsU0FBUyxDQUFDO1FBQ1QsUUFBUSxFQUFFLFdBQVc7UUFDckIseXhGQUFxQztRQUVyQyxlQUFlLEVBQUUsdUJBQXVCLENBQUMsTUFBTTs7S0FDaEQsQ0FBQztHQUNXLGNBQWMsQ0FvTjFCO1NBcE5ZLGNBQWMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgT25DaGFuZ2VzLCBTaW1wbGVDaGFuZ2VzLCBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ2xvY2tWaWV3VHlwZSwgQ2xvY2tOdW1iZXIsIElUaW1lRGF0YSwgQ2xvY2tNb2RlIH0gZnJvbSAnLi4vaW50ZXJmYWNlcy1hbmQtdHlwZXMnO1xuaW1wb3J0IHsgaXNBbGxvd2VkLCBnZXRJc0F2YWlsYWJlRm4gfSBmcm9tICcuLi91dGlsJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbWF0LWNsb2NrJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2Nsb2NrLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vY2xvY2suY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2hcbn0pXG5leHBvcnQgY2xhc3MgQ2xvY2tDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIG1vZGU6IENsb2NrTW9kZTtcbiAgQElucHV0KCkgdmlld1R5cGU6IENsb2NrVmlld1R5cGU7XG4gIEBJbnB1dCgpIGNvbG9yID0gJ3ByaW1hcnknO1xuICBASW5wdXQoKSBmb3JtYXR0ZWRWYWx1ZTogbnVtYmVyO1xuICBASW5wdXQoKSBtaW5EYXRlOiBEYXRlO1xuICBASW5wdXQoKSBtYXhEYXRlOiBEYXRlO1xuICBASW5wdXQoKSBpc1BtOiBib29sZWFuO1xuICBASW5wdXQoKSBmb3JtYXR0ZWRIb3VyczogbnVtYmVyO1xuICBASW5wdXQoKSBtaW51dGVzOiBudW1iZXI7XG4gIEBPdXRwdXQoKSBjaGFuZ2VFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIHVuYXZhaWxhYmxlU2VsZWN0aW9uOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgaW52YWxpZE1lcmlkaWVtOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgaW52YWxpZFNlbGVjdGlvbjogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcbiAgQE91dHB1dCgpIGNsZWFySW52YWxpZE1lcmlkaWVtOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIEBJbnB1dCgpIGFsbG93ZWQxMkhvdXJNYXAgPSBudWxsO1xuICBASW5wdXQoKSBhbGxvd2VkMjRIb3VyTWFwID0gbnVsbDtcblxuICBpc0Zvcm1hdHRlZFZhbHVlQWxsb3dlZCA9IHRydWU7XG5cbiAgaXNBdmFpbGFibGVGbjogUmV0dXJuVHlwZTx0eXBlb2YgZ2V0SXNBdmFpbGFiZUZuPjtcblxuICBtZXJpZGllbSA9IG51bGw7XG4gIHRvdWNoaW5nID0gZmFsc2U7XG4gIGFuZ2xlOiBudW1iZXI7XG4gIG51bWJlcnM6IENsb2NrTnVtYmVyW10gPSBbXTtcbiAgc2Vjb25kYXJ5TnVtYmVyczogQ2xvY2tOdW1iZXJbXSA9IFtdO1xuICBtaW51dGVEb3RzOiBDbG9ja051bWJlcltdID0gW107XG4gIGludmFsaWRNZXJpZGllbUVtaXR0ZWQgPSB0cnVlO1xuXG4gIGluaXRJc0FsbG93ZWRGbigpIHtcbiAgICBpZiAoIXRoaXMuYWxsb3dlZDEySG91ck1hcCAmJiAhdGhpcy5hbGxvd2VkMjRIb3VyTWFwKSB7IHJldHVybjsgfVxuICAgIHRoaXMuaXNBdmFpbGFibGVGbiA9IGdldElzQXZhaWxhYmVGbih0aGlzLmFsbG93ZWQxMkhvdXJNYXAsIHRoaXMuYWxsb3dlZDI0SG91ck1hcCwgdGhpcy5tb2RlKTtcbiAgfVxuXG4gIGlzQXZhaWxhYmxlKHZhbHVlKSB7XG4gICAgcmV0dXJuIHRoaXMuaXNBdmFpbGFibGVGbiA/IHRoaXMuaXNBdmFpbGFibGVGbih2YWx1ZSwgdGhpcy52aWV3VHlwZSwgdGhpcy5pc1BtLCB0aGlzLmZvcm1hdHRlZEhvdXJzKSA6IHRydWU7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhzaW1wbGVDaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG5cbiAgICBpZiAoXG4gICAgICBzaW1wbGVDaGFuZ2VzLmFsbG93ZWQxMkhvdXJNYXAgfHxcbiAgICAgIHNpbXBsZUNoYW5nZXMuYWxsb3dlZDI0SG91ck1hcCB8fFxuICAgICAgKHNpbXBsZUNoYW5nZXMubW9kZSAmJiAhc2ltcGxlQ2hhbmdlcy5tb2RlLmZpcnN0Q2hhbmdlKVxuICAgICkge1xuICAgICAgdGhpcy5pbml0SXNBbGxvd2VkRm4oKTtcbiAgICB9XG5cbiAgICB0aGlzLmNhbGN1bGF0ZUFuZ3VsZSgpO1xuICAgIHRoaXMuc2V0TnVtYmVycygpO1xuICAgIHRoaXMubWVyaWRpZW0gPSB0aGlzLmlzUG0gPyAnUE0nIDogJ0FNJztcblxuICAgIGlmIChzaW1wbGVDaGFuZ2VzLmZvcm1hdHRlZFZhbHVlICYmICh0aGlzLmFsbG93ZWQxMkhvdXJNYXAgfHwgdGhpcy5hbGxvd2VkMjRIb3VyTWFwKSkge1xuICAgICAgdGhpcy5pc0Zvcm1hdHRlZFZhbHVlQWxsb3dlZCA9IHRoaXMuaXNBdmFpbGFibGUodGhpcy5mb3JtYXR0ZWRWYWx1ZSk7XG4gICAgfVxuXG4gICAgY29uc3QgaXNTZWxlY3RlZFRpbWVBdmFpbGFibGUgPSAodGhpcy5pc0F2YWlsYWJsZUZuKSA/XG4gICAgICB0aGlzLmlzQXZhaWxhYmxlRm4odGhpcy5mb3JtYXR0ZWRWYWx1ZSwgJ21pbnV0ZXMnLCB0aGlzLmlzUG0sIHRoaXMuZm9ybWF0dGVkSG91cnMpIDogdHJ1ZTtcblxuICAgIGlmICh0aGlzLm1vZGUgPT09ICcyNGgnICYmIHRoaXMudmlld1R5cGUgPT09ICdtaW51dGVzJyAmJiB0aGlzLmlzQXZhaWxhYmxlRm4pIHtcbiAgICAgIGNvbnN0IGFyZU1pbml0ZXNBdmFpbGFibGUgPSB0aGlzLmlzQXZhaWxhYmxlRm4odGhpcy5taW51dGVzLCAnbWludXRlcycsIHRoaXMuaXNQbSwgdGhpcy5mb3JtYXR0ZWRIb3Vycyk7XG4gICAgICBpZiAoIWFyZU1pbml0ZXNBdmFpbGFibGUpIHtcbiAgICAgICAgaWYgKHRoaXMubWluRGF0ZSAmJiB0aGlzLm1pbkRhdGUuZ2V0TWludXRlcygpID4gdGhpcy5taW51dGVzKSB7XG4gICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7IHRoaXMuY2hhbmdlRXZlbnQuZW1pdCh7IHZhbHVlOiB0aGlzLm1pbkRhdGUuZ2V0TWludXRlcygpLCB0eXBlOiAnbWludXRlcycgfSk7IH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLmNoYW5nZUV2ZW50LmVtaXQoeyB2YWx1ZTogdGhpcy5tYXhEYXRlLmdldE1pbnV0ZXMoKSwgdHlwZTogJ21pbnV0ZXMnIH0pOyB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChpc1NlbGVjdGVkVGltZUF2YWlsYWJsZSAmJiB0aGlzLmludmFsaWRNZXJpZGllbUVtaXR0ZWQpIHtcbiAgICAgIHRoaXMuY2xlYXJJbnZhbGlkTWVyaWRpZW0uZW1pdCgpO1xuICAgICAgdGhpcy5pbnZhbGlkTWVyaWRpZW1FbWl0dGVkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgdGhpcy5pbnZhbGlkU2VsZWN0aW9uLmVtaXQoIWlzU2VsZWN0ZWRUaW1lQXZhaWxhYmxlKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZUFuZ3VsZSgpIHtcbiAgICB0aGlzLmFuZ2xlID0gdGhpcy5nZXRQb2ludGVyQW5nbGUodGhpcy5mb3JtYXR0ZWRWYWx1ZSwgdGhpcy52aWV3VHlwZSk7XG4gIH1cblxuICBzZXROdW1iZXJzKCkge1xuICAgIGlmICh0aGlzLnZpZXdUeXBlID09PSAnaG91cnMnKSB7XG4gICAgICBpZiAodGhpcy5tb2RlID09PSAnMTJoJykge1xuICAgICAgICBjb25zdCBtZXJpZGllbSA9IHRoaXMuaXNQbSA/ICdwbScgOiAnYW0nO1xuICAgICAgICBjb25zdCBpc0FsbG93ZWRGbiA9IHRoaXMuYWxsb3dlZDEySG91ck1hcCA/IG51bSA9PiB0aGlzLmFsbG93ZWQxMkhvdXJNYXBbbWVyaWRpZW1dW251bSArIDFdWzBdIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm51bWJlcnMgPSB0aGlzLmdldE51bWJlcnMoMTIsIHsgc2l6ZTogMjU2IH0sIGlzQWxsb3dlZEZuKTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlOdW1iZXJzID0gW107XG4gICAgICAgIHRoaXMubWludXRlRG90cyA9IFtdO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLm1vZGUgPT09ICcyNGgnKSB7XG4gICAgICAgIGNvbnN0IGlzQWxsb3dlZEZuID0gdGhpcy5hbGxvd2VkMjRIb3VyTWFwID8gbnVtID0+IHRoaXMuYWxsb3dlZDI0SG91ck1hcFtudW1dWzBdIDogdW5kZWZpbmVkO1xuICAgICAgICB0aGlzLm51bWJlcnMgPSB0aGlzLmdldE51bWJlcnMoMTIsIHsgc2l6ZTogMjU2IH0sIGlzQWxsb3dlZEZuKTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlOdW1iZXJzID0gdGhpcy5nZXROdW1iZXJzKDEyLCB7IHNpemU6IDI1NiAtIDY0LCBzdGFydDogMTMgfSwgaXNBbGxvd2VkRm4pO1xuICAgICAgICB0aGlzLm1pbnV0ZURvdHMgPSBbXTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgY29uc3QgbWVyaWRpZW0gPSB0aGlzLmlzUG0gPyAncG0nIDogJ2FtJztcbiAgICAgIGNvbnN0IGlzQWxsb3dlZEZuID1cbiAgICAgICAgISF0aGlzLmFsbG93ZWQxMkhvdXJNYXAgPyBudW0gPT4gdGhpcy5hbGxvd2VkMTJIb3VyTWFwW21lcmlkaWVtXVt0aGlzLmZvcm1hdHRlZEhvdXJzXVtudW1dIDpcbiAgICAgICAgICAhIXRoaXMuYWxsb3dlZDI0SG91ck1hcCA/IG51bSA9PiB0aGlzLmFsbG93ZWQyNEhvdXJNYXBbdGhpcy5mb3JtYXR0ZWRIb3Vyc11bbnVtXSA6IHVuZGVmaW5lZDtcblxuICAgICAgdGhpcy5udW1iZXJzID0gdGhpcy5nZXROdW1iZXJzKDEyLCB7IHNpemU6IDI1Niwgc3RhcnQ6IDUsIHN0ZXA6IDUgfSwgaXNBbGxvd2VkRm4pO1xuICAgICAgdGhpcy5taW51dGVEb3RzID0gdGhpcy5nZXROdW1iZXJzKDYwLCB7IHNpemU6IDI1Niwgc3RhcnQ6IDEzIH0pLm1hcChkaWdpdCA9PiB7XG4gICAgICAgIGlmIChkaWdpdC5kaXNwbGF5IDw9IDU5KSB7XG4gICAgICAgICAgZGlnaXQuYWxsb3dlZCA9IGlzQWxsb3dlZEZuID8gaXNBbGxvd2VkRm4oZGlnaXQuZGlzcGxheSkgOiB0cnVlO1xuICAgICAgICAgIHJldHVybiBkaWdpdDtcbiAgICAgICAgfVxuICAgICAgICBkaWdpdC5kaXNwbGF5ID0gZGlnaXQuZGlzcGxheSAtIDYwO1xuICAgICAgICBkaWdpdC5hbGxvd2VkID0gaXNBbGxvd2VkRm4gPyBpc0FsbG93ZWRGbihkaWdpdC5kaXNwbGF5KSA6IHRydWU7XG4gICAgICAgIHJldHVybiBkaWdpdDtcbiAgICAgIH0pO1xuICAgICAgdGhpcy5zZWNvbmRhcnlOdW1iZXJzID0gW107XG4gICAgfVxuICB9XG5cbiAgZGlzYWJsZUFuaW1hdGVkUG9pbnRlcigpIHtcbiAgICB0aGlzLnRvdWNoaW5nID0gdHJ1ZTtcbiAgfVxuXG4gIGVuYWJsZUFuaW1hdGVkUG9pbnRlcigpIHtcbiAgICB0aGlzLnRvdWNoaW5nID0gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVUb3VjaE1vdmUgPSAoZTogYW55KSA9PiB7XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAvLyBwcmV2ZW50IHNjcm9sbGluZyBiZWhpbmQgdGhlIGNsb2NrIG9uIGlPU1xuICAgIGNvbnN0IHJlY3QgPSBlLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICB0aGlzLm1vdmVQb2ludGVyKGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WCAtIHJlY3QubGVmdCwgZS5jaGFuZ2VkVG91Y2hlc1swXS5jbGllbnRZIC0gcmVjdC50b3ApO1xuICB9XG5cbiAgaGFuZGxlVG91Y2hFbmQoZTogYW55KSB7XG4gICAgdGhpcy5oYW5kbGVUb3VjaE1vdmUoZSk7XG4gICAgdGhpcy5lbmFibGVBbmltYXRlZFBvaW50ZXIoKTtcbiAgfVxuXG4gIGhhbmRsZU1vdXNlTW92ZShlOiBhbnkpIHtcbiAgICAvLyBNb3VzZUV2ZW50LndoaWNoIGlzIGRlcHJlY2F0ZWQsIGJ1dCBNb3VzZUV2ZW50LmJ1dHRvbnMgaXMgbm90IHN1cHBvcnRlZCBpbiBTYWZhcmlcbiAgICBpZiAoZS5idXR0b25zID09PSAxIHx8IGUud2hpY2ggPT09IDEpIHtcbiAgICAgIGNvbnN0IHJlY3QgPSBlLnRhcmdldC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIHRoaXMubW92ZVBvaW50ZXIoZS5jbGllbnRYIC0gcmVjdC5sZWZ0LCBlLmNsaWVudFkgLSByZWN0LnRvcCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlQ2xpY2soZTogYW55KSB7XG4gICAgY29uc3QgcmVjdCA9IGUudGFyZ2V0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHRoaXMubW92ZVBvaW50ZXIoZS5jbGllbnRYIC0gcmVjdC5sZWZ0LCBlLmNsaWVudFkgLSByZWN0LnRvcCk7XG4gIH1cblxuICBtb3ZlUG9pbnRlcih4LCB5KSB7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmdldFBvaW50ZXJWYWx1ZSh4LCB5LCAyNTYpO1xuICAgIGlmICghdGhpcy5pc0F2YWlsYWJsZSh2YWx1ZSkpIHtcbiAgICAgIHRoaXMudW5hdmFpbGFibGVTZWxlY3Rpb24uZW1pdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodmFsdWUgIT09IHRoaXMuZm9ybWF0dGVkVmFsdWUpIHtcbiAgICAgIHRoaXMuY2hhbmdlRXZlbnQuZW1pdCh7IHZhbHVlLCB0eXBlOiB0aGlzLnZpZXdUeXBlICE9PSAnbWludXRlcycgPyAnaG91cnMnIDogJ21pbnV0ZXMnIH0pO1xuICAgICAgaWYgKHRoaXMudmlld1R5cGUgIT09ICdtaW51dGVzJykge1xuICAgICAgICBpZiAoIXRoaXMuaXNBdmFpbGFibGUodmFsdWUpKSB7XG4gICAgICAgICAgaWYgKHRoaXMubWluRGF0ZSAmJiB0aGlzLmlzQXZhaWxhYmxlKHZhbHVlKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KHsgdmFsdWU6IHRoaXMubWluRGF0ZS5nZXRNaW51dGVzKCksIHR5cGU6ICdtaW51dGVzJyB9KTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMubWF4RGF0ZSAmJiB0aGlzLmlzQXZhaWxhYmxlKHZhbHVlKSkge1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KHsgdmFsdWU6IHRoaXMubWF4RGF0ZS5nZXRNaW51dGVzKCksIHR5cGU6ICdtaW51dGVzJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBnZXROdW1iZXJzKGNvdW50LCB7IHNpemUsIHN0YXJ0ID0gMSwgc3RlcCA9IDEgfSwgaXNBbGxvd2VkRm4/OiAobnVtOiBudW1iZXIpID0+IGJvb2xlYW4pIHtcbiAgICByZXR1cm4gQXJyYXkuYXBwbHkobnVsbCwgQXJyYXkoY291bnQpKS5tYXAoKF8sIGkpID0+ICh7XG4gICAgICBkaXNwbGF5OiBpICogc3RlcCArIHN0YXJ0LFxuICAgICAgdHJhbnNsYXRlWDogKHNpemUgLyAyIC0gMjApICogTWF0aC5jb3MoMiAqIE1hdGguUEkgKiAoaSAtIDIpIC8gY291bnQpLFxuICAgICAgdHJhbnNsYXRlWTogKHNpemUgLyAyIC0gMjApICogTWF0aC5zaW4oMiAqIE1hdGguUEkgKiAoaSAtIDIpIC8gY291bnQpLFxuICAgICAgYWxsb3dlZDogaXNBbGxvd2VkRm4gPyBpc0FsbG93ZWRGbihpKSA6IHRydWVcbiAgICB9KSk7XG4gIH1cblxuICBnZXRQb2ludGVyQW5nbGUodmFsdWUsIG1vZGU6IENsb2NrVmlld1R5cGUpIHtcbiAgICBpZiAodGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJykge1xuICAgICAgcmV0dXJuIHRoaXMubW9kZSA9PT0gJzEyaCcgPyAzNjAgLyAxMiAqICh2YWx1ZSAtIDMpIDogMzYwIC8gMTIgKiAodmFsdWUgJSAxMiAtIDMpO1xuICAgIH1cbiAgICByZXR1cm4gMzYwIC8gNjAgKiAodmFsdWUgLSAxNSk7XG4gIH1cblxuICBnZXRQb2ludGVyVmFsdWUoeCwgeSwgc2l6ZSkge1xuICAgIGxldCB2YWx1ZTtcbiAgICBsZXQgYW5nbGUgPSBNYXRoLmF0YW4yKHNpemUgLyAyIC0geCwgc2l6ZSAvIDIgLSB5KSAvIE1hdGguUEkgKiAxODA7XG4gICAgaWYgKGFuZ2xlIDwgMCkge1xuICAgICAgYW5nbGUgPSAzNjAgKyBhbmdsZTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy52aWV3VHlwZSA9PT0gJ2hvdXJzJykge1xuICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJzEyaCcpIHtcbiAgICAgICAgdmFsdWUgPSAxMiAtIE1hdGgucm91bmQoYW5nbGUgKiAxMiAvIDM2MCk7XG4gICAgICAgIHJldHVybiB2YWx1ZSA9PT0gMCA/IDEyIDogdmFsdWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJhZGl1cyA9IE1hdGguc3FydChNYXRoLnBvdyhzaXplIC8gMiAtIHgsIDIpICsgTWF0aC5wb3coc2l6ZSAvIDIgLSB5LCAyKSk7XG4gICAgICB2YWx1ZSA9IDEyIC0gTWF0aC5yb3VuZChhbmdsZSAqIDEyIC8gMzYwKTtcbiAgICAgIGlmICh2YWx1ZSA9PT0gMCkgeyB2YWx1ZSA9IDEyOyB9XG4gICAgICBpZiAocmFkaXVzIDwgc2l6ZSAvIDIgLSAzMikgeyB2YWx1ZSA9IHZhbHVlID09PSAxMiA/IDAgOiB2YWx1ZSArIDEyOyB9XG4gICAgICByZXR1cm4gdmFsdWU7XG5cbiAgICB9XG5cbiAgICB2YWx1ZSA9IE1hdGgucm91bmQoNjAgLSA2MCAqIGFuZ2xlIC8gMzYwKTtcbiAgICByZXR1cm4gdmFsdWUgPT09IDYwID8gMCA6IHZhbHVlO1xuICB9XG59XG4iXX0=