import { __decorate, __param } from "tslib";
import { MAT_DIALOG_DATA } from '@angular/material/dialog';
import { Component, EventEmitter, Output, Inject } from '@angular/core';
import { twoDigits, convertHoursForMode } from '../util';
let MatTimepickerComponentDialogComponent = class MatTimepickerComponentDialogComponent {
    constructor(data) {
        this.data = data;
        this.twoDigits = twoDigits;
        this.changeEvent = new EventEmitter();
        this.okClickEvent = new EventEmitter();
        this.cancelClickEvent = new EventEmitter();
        this.allowed24HourMap = null;
        this.allowed12HourMap = null;
        this.invalidSelection = false;
        this.viewType = 'hours';
        this.isPm = false;
        this.skipMinuteAutoSwitch = false;
        this.autoSwitchID = null;
        this.invalidMedianID = null;
        this.hasInvalidMeridiem = false;
        this.editHoursClicked = false;
        this.isClosing = false;
        this.isPm = data.isPm;
        this.bindData(data);
        // keep this always at the bottom
        this.value = data.value;
    }
    set value(value) {
        value = value || this.minDate || this.maxDate || new Date();
        this.hours = value.getHours();
        this.minutes = value.getMinutes();
        this._value = value;
    }
    get value() { return this._value; }
    set hours(value) {
        this._hours = value;
        this._formattedHour = convertHoursForMode(this.hours, this.mode).hour;
    }
    get hours() { return this._hours; }
    get formattedHours() { return this._formattedHour; }
    bindData(data) {
        this.mode = data.mode;
        this.okLabel = data.okLabel;
        this.cancelLabel = data.cancelLabel;
        this.color = data.color;
        this.minDate = data.minDate;
        this.maxDate = data.maxDate;
        this.allowed12HourMap = data.allowed12HourMap;
        this.allowed24HourMap = data.allowed24HourMap;
    }
    ngDoCheck() { this.bindData(this.data); }
    handleClockChange({ value, type }) {
        const is24hoursAutoMeridiemChange = this.mode === '24h' && type === 'hours' && ((this.hours >= 12 && value < 12) || (this.hours < 12 && value >= 12));
        if ((this.hasInvalidMeridiem && this.mode === '12h') || is24hoursAutoMeridiemChange) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        if ((type && type === 'hours') || (!type && this.viewType === 'hours')) {
            this.hours = value;
        }
        else if ((type && type === 'minutes') || (!type && this.viewType === 'minutes')) {
            this.minutes = value;
        }
        const newValue = new Date();
        const hours = this.isPm ? this.hours < 12 ? this.hours + 12 : this.hours : this.hours === 12 ? 0 : this.hours;
        newValue.setHours(hours);
        newValue.setMinutes(this.minutes);
        newValue.setSeconds(0);
        newValue.setMilliseconds(0);
        this.value = newValue;
        this.changeEvent.emit(newValue);
    }
    clearInvalidMeridiem() {
        this.hasInvalidMeridiem = false;
    }
    handleUnavailableSelection() {
        clearTimeout(this.autoSwitchID);
    }
    handleClockChangeDone(e) {
        e.preventDefault(); // prevent mouseUp after touchEnd
        if (this.viewType === 'hours' && !this.skipMinuteAutoSwitch) {
            this.autoSwitchID = setTimeout(() => {
                this.editMinutes();
                this.autoSwitchID = null;
            }, 300);
        }
    }
    editHours() {
        this.viewType = 'hours';
        this.editHoursClicked = true;
        setTimeout(() => { this.editHoursClicked = false; }, 0);
    }
    editMinutes() {
        if (this.hasInvalidMeridiem) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        this.viewType = 'minutes';
    }
    invalidSelectionHandler(value) {
        this.invalidSelection = value;
    }
    invalidMeridiem() {
        if (this.viewType !== 'minutes' && this.editHoursClicked) {
            if (this.invalidMedianID) {
                return;
            }
            this.invalidMedianID = setTimeout(() => {
                this.isPm = !this.isPm;
                this.hasInvalidMeridiem = false;
            }, 0);
            return;
        }
        this.hasInvalidMeridiem = true;
    }
    meridiemChange(hours) {
        const changeData = {
            type: this.viewType,
            value: this.viewType === 'hours' ? hours : this.value.getMinutes()
        };
        this.handleClockChange(changeData);
    }
    setAm() {
        if (this.hours >= 12) {
            this.hours = this.hours - 12;
        }
        this.isPm = false;
        this.meridiemChange(this.hours);
    }
    setPm() {
        if (this.hours < 12) {
            this.hours = this.hours + 12;
        }
        this.isPm = true;
        this.meridiemChange(this.hours);
    }
    okClickHandler() {
        if (this.hasInvalidMeridiem) {
            this.isPm = !this.isPm;
            this.hasInvalidMeridiem = false;
        }
        this.okClickEvent.emit();
    }
    cancelClickHandler() {
        this.cancelClickEvent.emit();
    }
};
MatTimepickerComponentDialogComponent.ctorParameters = () => [
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
__decorate([
    Output()
], MatTimepickerComponentDialogComponent.prototype, "changeEvent", void 0);
__decorate([
    Output()
], MatTimepickerComponentDialogComponent.prototype, "okClickEvent", void 0);
__decorate([
    Output()
], MatTimepickerComponentDialogComponent.prototype, "cancelClickEvent", void 0);
MatTimepickerComponentDialogComponent = __decorate([
    Component({
        selector: 'mat-timepicker-dialog',
        template: "<mat-dialog-content>\n  <div class=\"root\">\n    <mat-toolbar [color]=\"color\" class=\"header\">\n      <div class=\"placeholder\"></div>\n      <div class=\"time-frame\">\n        <span class=\"time fixed-font-size\" [ngClass]=\"{'select': this.viewType === 'hours' && 'active' }\"\n          (click)=\"editHours()\">\n          {{ twoDigits(formattedHours) }}\n        </span>\n        <span class=\"fixed-font-size\">:</span>\n        <span class=\"time fixed-font-size\" [ngClass]=\"{ 'select': this.viewType === 'minutes' && 'active' }\"\n          (click)=\"editMinutes()\">\n          {{ twoDigits(minutes) }}\n        </span>\n      </div>\n      <ng-container *ngIf=\"mode === '12h' then ampm else normal\"></ng-container>\n      <ng-template #normal>\n        <div class=\"placeholder\"></div>\n      </ng-template>\n      <ng-template #ampm>\n        <div class=\"ampm\">\n          <span class=\"time\" [ngClass]=\"{ 'select': isPm }\" (click)=\"setPm()\">PM</span>\n          <span class=\"time\" [ngClass]=\"{ 'select': !isPm }\" (click)=\"setAm()\">AM</span>\n        </div>\n      </ng-template>\n    </mat-toolbar>\n    <div class=\"body\">\n      <mat-clock [allowed12HourMap]=\"allowed12HourMap\" [allowed24HourMap]=\"allowed24HourMap\" [minDate]=\"minDate\"\n        [maxDate]=\"maxDate\" [color]=\"color\" [viewType]=\"viewType\" [mode]=\"mode\" [formattedHours]=\"formattedHours\"\n        [minutes]=\"minutes\" (changeEvent)=\"handleClockChange($event)\"\n        (unavailableSelection)=\"handleUnavailableSelection()\"\n        [formattedValue]=\"viewType === 'minutes' ? minutes : formattedHours\" [isPm]=\"isPm\"\n        (invalidMeridiem)=\"invalidMeridiem()\" (mouseup)=\"handleClockChangeDone($event)\"\n        (clearInvalidMeridiem)=\"clearInvalidMeridiem()\" (touchend)=\"handleClockChangeDone($event)\"\n        (invalidSelection)=\"invalidSelectionHandler($event)\"></mat-clock>\n    </div>\n  </div>\n</mat-dialog-content>\n<mat-dialog-actions>\n  <button mat-button i18n=\"mat-timepicker|Material Timepicker Cancel Button Text\" [color]=\"color\"\n    (click)=\"cancelClickHandler()\">{{cancelLabel}}</button>\n  <button mat-button i18n=\"mat-timepicker|Material Timepicker Ok Button Text\" [disabled]=\"invalidSelection\"\n    [color]=\"color\" (click)=\"okClickHandler()\">{{okLabel}}</button>\n</mat-dialog-actions>",
        styles: ["mat-dialog-content{min-height:395px;padding:0;margin-top:-24px;overflow:hidden}mat-dialog-actions{justify-content:flex-end;margin-right:-8px;margin-left:-8px}.root{min-width:282px}.header{border-top-left-radius:2px;border-top-right-radius:2px;padding:20px 0;line-height:58px;font-size:58px;display:flex;justify-content:center;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;height:98px}.header .fixed-font-size{font-size:58px}.header .time-frame{height:60px}.time{transition:.2s ease-out;cursor:pointer}.time:not(.select){opacity:.6}.placeholder{flex:1}.ampm{display:flex;flex-direction:column-reverse;flex:1;font-size:14px;line-height:20px;margin-left:16px;font-weight:700px}.select{color:#fff}.body{padding:24px 16px 20px;display:flex;justify-content:center}"]
    }),
    __param(0, Inject(MAT_DIALOG_DATA))
], MatTimepickerComponentDialogComponent);
export { MatTimepickerComponentDialogComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0LXRpbWVwaWNrZXIvIiwic291cmNlcyI6WyJsaWIvdGltZXBpY2tlci1kaWFsb2cvdGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDM0QsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBVyxNQUFNLGVBQWUsQ0FBQztBQUVqRixPQUFPLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFDO0FBT3pELElBQWEscUNBQXFDLEdBQWxELE1BQWEscUNBQXFDO0lBbUVoRCxZQUE0QyxJQUFJO1FBQUosU0FBSSxHQUFKLElBQUksQ0FBQTtRQWpFaEQsY0FBUyxHQUFHLFNBQVMsQ0FBQztRQUVaLGdCQUFXLEdBQXNCLElBQUksWUFBWSxFQUFPLENBQUM7UUFDekQsaUJBQVksR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUMxRCxxQkFBZ0IsR0FBc0IsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUV4RSxxQkFBZ0IsR0FBc0IsSUFBSSxDQUFDO1FBQzNDLHFCQUFnQixHQUFzQixJQUFJLENBQUM7UUFFM0MscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBZXpCLGFBQVEsR0FBa0IsT0FBTyxDQUFDO1FBSWxDLFNBQUksR0FBRyxLQUFLLENBQUM7UUFDYix5QkFBb0IsR0FBRyxLQUFLLENBQUM7UUFDN0IsaUJBQVksR0FBRyxJQUFJLENBQUM7UUFDcEIsb0JBQWUsR0FBRyxJQUFJLENBQUM7UUFDdkIsdUJBQWtCLEdBQUcsS0FBSyxDQUFDO1FBQzNCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQUN6QixjQUFTLEdBQUcsS0FBSyxDQUFDO1FBZ0NoQixJQUFJLENBQUMsSUFBSSxHQUFHLElBQUks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Q0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBRUQsa0JBQWtCO1FBQ2hCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMvQixDQUFDO0NBRUYsQ0FBQTs7NENBekhjLE1BQU0sU0FBQyxlQUFlOztBQS9EekI7SUFBVCxNQUFNLEVBQUU7MEVBQTBEO0FBQ3pEO0lBQVQsTUFBTSxFQUFFOzJFQUEyRDtBQUMxRDtJQUFULE1BQU0sRUFBRTsrRUFBK0Q7QUFON0QscUNBQXFDO0lBTGpELFNBQVMsQ0FBQztRQUNULFFBQVEsRUFBRSx1QkFBdUI7UUFDakMsZzBFQUFpRDs7S0FFbEQsQ0FBQztJQW9FYSxXQUFBLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQTtHQW5FekIscUNBQXFDLENBNExqRDtTQTVMWSxxQ0FBcUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNQVRfRElBTE9HX0RBVEEgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIE91dHB1dCwgSW5qZWN0LCBEb0NoZWNrIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBDbG9ja1ZpZXdUeXBlLCBDbG9ja01vZGUsIElBbGxvd2VkMjRIb3VyTWFwLCBJQWxsb3dlZDEySG91ck1hcCB9IGZyb20gJy4uL2ludGVyZmFjZXMtYW5kLXR5cGVzJztcbmltcG9ydCB7IHR3b0RpZ2l0cywgY29udmVydEhvdXJzRm9yTW9kZSB9IGZyb20gJy4uL3V0aWwnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtYXQtdGltZXBpY2tlci1kaWFsb2cnLFxuICB0ZW1wbGF0ZVVybDogJy4vdGltZXBpY2tlci1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi90aW1lcGlja2VyLWRpYWxvZy5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIE1hdFRpbWVwaWNrZXJDb21wb25lbnREaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBEb0NoZWNrIHtcblxuICB0d29EaWdpdHMgPSB0d29EaWdpdHM7XG5cbiAgQE91dHB1dCgpIGNoYW5nZUV2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgb2tDbGlja0V2ZW50OiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuICBAT3V0cHV0KCkgY2FuY2VsQ2xpY2tFdmVudDogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyPGFueT4oKTtcblxuICBhbGxvd2VkMjRIb3VyTWFwOiBJQWxsb3dlZDI0SG91ck1hcCA9IG51bGw7XG4gIGFsbG93ZWQxMkhvdXJNYXA6IElBbGxvd2VkMTJIb3VyTWFwID0gbnVsbDtcblxuICBpbnZhbGlkU2VsZWN0aW9uID0gZmFsc2U7XG5cbiAgb2tMYWJlbDogc3RyaW5nO1xuICBjYW5jZWxMYWJlbDogc3RyaW5nO1xuXG4gIHNldCB2YWx1ZSh2YWx1ZTogYW55KSB7XG4gICAgdmFsdWUgPSB2YWx1ZSB8fCB0aGlzLm1pbkRhdGUgfHwgdGhpcy5tYXhEYXRlIHx8IG5ldyBEYXRlKCk7XG4gICAgdGhpcy5ob3VycyA9IHZhbHVlLmdldEhvdXJzKCk7XG4gICAgdGhpcy5taW51dGVzID0gdmFsdWUuZ2V0TWludXRlcygpO1xuICAgIHRoaXMuX3ZhbHVlID0gdmFsdWU7XG4gIH1cblxuICBnZXQgdmFsdWUoKSB7IHJldHVybiB0aGlzLl92YWx1ZTsgfVxuXG4gIG1vZGU6IENsb2NrTW9kZTtcbiAgdmlld1R5cGU6IENsb2NrVmlld1R5cGUgPSAnaG91cnMnO1xuXG4gIG1pbnV0ZXM6IGFueTtcbiAgY29sb3I6IHN0cmluZztcbiAgaXNQbSA9IGZhbHNlO1xuICBza2lwTWludXRlQXV0b1N3aXRjaCA9IGZhbHNlO1xuICBhdXRvU3dpdGNoSUQgPSBudWxsO1xuICBpbnZhbGlkTWVkaWFuSUQgPSBudWxsO1xuICBoYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgZWRpdEhvdXJzQ2xpY2tlZCA9IGZhbHNlO1xuICBpc0Nsb3NpbmcgPSBmYWxzZTtcblxuICBtaW5EYXRlOiBEYXRlO1xuICBtYXhEYXRlOiBEYXRlO1xuXG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG4gIF9mb3JtYXR0ZWRIb3VyOiBhbnk7XG4gIC8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTp2YXJpYWJsZS1uYW1lXG4gIF9ob3VyczogYW55O1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6dmFyaWFibGUtbmFtZVxuICBfdmFsdWU6IERhdGU7XG5cbiAgc2V0IGhvdXJzKHZhbHVlOiBhbnkpIHtcbiAgICB0aGlzLl9ob3VycyA9IHZhbHVlO1xuICAgIHRoaXMuX2Zvcm1hdHRlZEhvdXIgPSBjb252ZXJ0SG91cnNGb3JNb2RlKHRoaXMuaG91cnMsIHRoaXMubW9kZSkuaG91cjtcbiAgfVxuICBnZXQgaG91cnMoKSB7IHJldHVybiB0aGlzLl9ob3VyczsgfVxuXG4gIGdldCBmb3JtYXR0ZWRIb3VycygpIHsgcmV0dXJuIHRoaXMuX2Zvcm1hdHRlZEhvdXI7IH1cblxuICBiaW5kRGF0YShkYXRhOiBhbnkpIHtcbiAgICB0aGlzLm1vZGUgPSBkYXRhLm1vZGU7XG4gICAgdGhpcy5va0xhYmVsID0gZGF0YS5va0xhYmVsO1xuICAgIHRoaXMuY2FuY2VsTGFiZWwgPSBkYXRhLmNhbmNlbExhYmVsO1xuICAgIHRoaXMuY29sb3IgPSBkYXRhLmNvbG9yO1xuICAgIHRoaXMubWluRGF0ZSA9IGRhdGEubWluRGF0ZTtcbiAgICB0aGlzLm1heERhdGUgPSBkYXRhLm1heERhdGU7XG4gICAgdGhpcy5hbGxvd2VkMTJIb3VyTWFwID0gZGF0YS5hbGxvd2VkMTJIb3VyTWFwO1xuICAgIHRoaXMuYWxsb3dlZDI0SG91ck1hcCA9IGRhdGEuYWxsb3dlZDI0SG91ck1hcDtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoTUFUX0RJQUxPR19EQVRBKSBwdWJsaWMgZGF0YSkge1xuICAgIHRoaXMuaXNQbSA9IGRhdGEuaXNQbTtcbiAgICB0aGlzLmJpbmREYXRhKGRhdGEpO1xuICAgIC8vIGtlZXAgdGhpcyBhbHdheXMgYXQgdGhlIGJvdHRvbVxuICAgIHRoaXMudmFsdWUgPSBkYXRhLnZhbHVlO1xuICB9XG5cbiAgbmdEb0NoZWNrKCkgeyB0aGlzLmJpbmREYXRhKHRoaXMuZGF0YSk7IH1cblxuICBoYW5kbGVDbG9ja0NoYW5nZSh7IHZhbHVlLCB0eXBlIH06IHsgdmFsdWU6IG51bWJlciwgdHlwZTogJ21pbnV0ZXMnIHwgJ2hvdXJzJyB9KSB7XG4gICAgY29uc3QgaXMyNGhvdXJzQXV0b01lcmlkaWVtQ2hhbmdlID0gdGhpcy5tb2RlID09PSAnMjRoJyAmJiB0eXBlID09PSAnaG91cnMnICYmIChcbiAgICAgICh0aGlzLmhvdXJzID49IDEyICYmIHZhbHVlIDwgMTIpIHx8ICh0aGlzLmhvdXJzIDwgMTIgJiYgdmFsdWUgPj0gMTIpKTtcbiAgICBpZiAoKHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtICYmIHRoaXMubW9kZSA9PT0gJzEyaCcpIHx8IGlzMjRob3Vyc0F1dG9NZXJpZGllbUNoYW5nZSkge1xuICAgICAgdGhpcy5pc1BtID0gIXRoaXMuaXNQbTtcbiAgICAgIHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtID0gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKCh0eXBlICYmIHR5cGUgPT09ICdob3VycycpIHx8ICghdHlwZSAmJiB0aGlzLnZpZXdUeXBlID09PSAnaG91cnMnKSkge1xuICAgICAgdGhpcy5ob3VycyA9IHZhbHVlO1xuICAgIH0gZWxzZSBpZiAoKHR5cGUgJiYgdHlwZSA9PT0gJ21pbnV0ZXMnKSB8fCAoIXR5cGUgJiYgdGhpcy52aWV3VHlwZSA9PT0gJ21pbnV0ZXMnKSkge1xuICAgICAgdGhpcy5taW51dGVzID0gdmFsdWU7XG4gICAgfVxuXG4gICAgY29uc3QgbmV3VmFsdWUgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IGhvdXJzID0gdGhpcy5pc1BtID8gdGhpcy5ob3VycyA8IDEyID8gdGhpcy5ob3VycyArIDEyIDogdGhpcy5ob3VycyA6IHRoaXMuaG91cnMgPT09IDEyID8gMCA6IHRoaXMuaG91cnM7XG4gICAgbmV3VmFsdWUuc2V0SG91cnMoaG91cnMpO1xuICAgIG5ld1ZhbHVlLnNldE1pbnV0ZXModGhpcy5taW51dGVzKTtcbiAgICBuZXdWYWx1ZS5zZXRTZWNvbmRzKDApO1xuICAgIG5ld1ZhbHVlLnNldE1pbGxpc2Vjb25kcygwKTtcbiAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KG5ld1ZhbHVlKTtcbiAgfVxuXG4gIGNsZWFySW52YWxpZE1lcmlkaWVtKCkge1xuICAgIHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtID0gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVVbmF2YWlsYWJsZVNlbGVjdGlvbigpIHtcbiAgICBjbGVhclRpbWVvdXQodGhpcy5hdXRvU3dpdGNoSUQpO1xuICB9XG5cbiAgaGFuZGxlQ2xvY2tDaGFuZ2VEb25lKGUpIHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7IC8vIHByZXZlbnQgbW91c2VVcCBhZnRlciB0b3VjaEVuZFxuXG4gICAgaWYgKHRoaXMudmlld1R5cGUgPT09ICdob3VycycgJiYgIXRoaXMuc2tpcE1pbnV0ZUF1dG9Td2l0Y2gpIHtcbiAgICAgIHRoaXMuYXV0b1N3aXRjaElEID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHRoaXMuZWRpdE1pbnV0ZXMoKTtcbiAgICAgICAgdGhpcy5hdXRvU3dpdGNoSUQgPSBudWxsO1xuICAgICAgfSwgMzAwKTtcbiAgICB9XG4gIH1cblxuICBlZGl0SG91cnMoKSB7XG4gICAgdGhpcy52aWV3VHlwZSA9ICdob3Vycyc7XG4gICAgdGhpcy5lZGl0SG91cnNDbGlja2VkID0gdHJ1ZTtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHsgdGhpcy5lZGl0SG91cnNDbGlja2VkID0gZmFsc2U7IH0sIDApO1xuICB9XG5cbiAgZWRpdE1pbnV0ZXMoKSB7XG4gICAgaWYgKHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtKSB7XG4gICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy52aWV3VHlwZSA9ICdtaW51dGVzJztcbiAgfVxuXG4gIGludmFsaWRTZWxlY3Rpb25IYW5kbGVyKHZhbHVlKSB7XG4gICAgdGhpcy5pbnZhbGlkU2VsZWN0aW9uID0gdmFsdWU7XG4gIH1cblxuXG4gIGludmFsaWRNZXJpZGllbSgpIHtcbiAgICBpZiAodGhpcy52aWV3VHlwZSAhPT0gJ21pbnV0ZXMnICYmIHRoaXMuZWRpdEhvdXJzQ2xpY2tlZCkge1xuICAgICAgaWYgKHRoaXMuaW52YWxpZE1lZGlhbklEKSB7IHJldHVybjsgfVxuICAgICAgdGhpcy5pbnZhbGlkTWVkaWFuSUQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5pc1BtID0gIXRoaXMuaXNQbTtcbiAgICAgICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgICAgIH0sIDApO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmhhc0ludmFsaWRNZXJpZGllbSA9IHRydWU7XG4gIH1cblxuICBtZXJpZGllbUNoYW5nZShob3Vycykge1xuICAgIGNvbnN0IGNoYW5nZURhdGEgPSB7XG4gICAgICB0eXBlOiB0aGlzLnZpZXdUeXBlLFxuICAgICAgdmFsdWU6IHRoaXMudmlld1R5cGUgPT09ICdob3VycycgPyBob3VycyA6IHRoaXMudmFsdWUuZ2V0TWludXRlcygpXG4gICAgfTtcbiAgICB0aGlzLmhhbmRsZUNsb2NrQ2hhbmdlKGNoYW5nZURhdGEpO1xuICB9XG5cblxuICBzZXRBbSgpIHtcbiAgICBpZiAodGhpcy5ob3VycyA+PSAxMikge1xuICAgICAgdGhpcy5ob3VycyA9IHRoaXMuaG91cnMgLSAxMjtcbiAgICB9XG4gICAgdGhpcy5pc1BtID0gZmFsc2U7XG5cbiAgICB0aGlzLm1lcmlkaWVtQ2hhbmdlKHRoaXMuaG91cnMpO1xuICB9XG5cbiAgc2V0UG0oKSB7XG4gICAgaWYgKHRoaXMuaG91cnMgPCAxMikge1xuICAgICAgdGhpcy5ob3VycyA9IHRoaXMuaG91cnMgKyAxMjtcbiAgICB9XG4gICAgdGhpcy5pc1BtID0gdHJ1ZTtcbiAgICB0aGlzLm1lcmlkaWVtQ2hhbmdlKHRoaXMuaG91cnMpO1xuICB9XG5cbiAgb2tDbGlja0hhbmRsZXIoKSB7XG4gICAgaWYgKHRoaXMuaGFzSW52YWxpZE1lcmlkaWVtKSB7XG4gICAgICB0aGlzLmlzUG0gPSAhdGhpcy5pc1BtO1xuICAgICAgdGhpcy5oYXNJbnZhbGlkTWVyaWRpZW0gPSBmYWxzZTtcbiAgICB9XG4gICAgdGhpcy5va0NsaWNrRXZlbnQuZW1pdCgpO1xuICB9XG5cbiAgY2FuY2VsQ2xpY2tIYW5kbGVyKCkge1xuICAgIHRoaXMuY2FuY2VsQ2xpY2tFdmVudC5lbWl0KCk7XG4gIH1cblxufVxuIl19